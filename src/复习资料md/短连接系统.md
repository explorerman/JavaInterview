原理： 短连接原理非常简单，就是用户访问短连接地址，到达我们的短连接网站，然后网站通过短连接里的code，查询数据库得到原始url，然后让网页跳转到原始url即可。 

[参考链接1](https://hufangyun.com/2017/short-url/)

[参考链接](https://www.cnblogs.com/zh605929205/p/7675775.html)

[知乎参考链接](https://www.zhihu.com/question/29270034)

定义：

URL短连接通俗来说，就是一个长的URL经过某些策略变成短的。

 **借助短网址您可以用简短的网址替代原来冗长的网址，让使用者可以更容易的分享链接。** 

为什么需要短连接系统？好处是什么？

至于为什么要使用短链接，很多人说美观，短，字符少，便于发布，传播等。

从我的角度来说，短，美观，便于发布，传播这些并不是啥优点，并不是必须的，现在在微信中打开拼爹爹的链接，依然是显示一大串URL，对于想薅拼爹爹羊毛的大妈们也不会有啥影响。字符少确实可以应用于微博的短微博发布。

我觉得这个系统真正的价值是可以用于监控不合法信息和信息推广。

1.  短网址可以在我们项目里可以很好的对开放级URL进行管理。有一部分网址可以会涵盖暴力，广告等信息，这样我们可以通过用户的举报，完全管理这个连接将不出现在我们的应用中，应为同样的URL通过加密算法之后，得到的地址是一样的。 
2.  我们可以对一系列的网址进行流量，点击等统计，挖掘出大多数用户的关注点，这样有利于我们对项目的后续工作更好的作出决策。 

短链接构成？

协议+域名+参数

http://xx.cn/xx1

用途？

实现方式：

1.发号器+redis存储长短链接的kv

2.md5随机hash

 通过发号策略，给每一个过来的长地址，发一个号即可

1.  小型系统直接用mysql的自增索引，一个自增id，对应于长URL； 

2.  大型应用，可以考虑各种分布式key-value系统做发号器。不停的自增就行了 

   第一个使用这个服务的人得到的短地址是[http://xx.xx/0](https://link.zhihu.com/?target=http%3A//xx.xx/0) 第二个是 [http://xx.xx/1](https://link.zhihu.com/?target=http%3A//xx.xx/1) 第11个是 [http://xx.xx/a](https://link.zhihu.com/?target=http%3A//xx.xx/a) 第依次往后，相当于实现了一个62进制的自增字段即可。10个数字+26个小写字母+26个大写字母。

3. 使用md5

   1.  将长网址 `md5` 生成 32 位签名串,分为 4 段, 每段 8 个字节
   2.  对这四段循环处理, 取 8 个字节, 将他看成 16 进制串与 0x3fffffff(30位1) 与操作, 即超过 30 位的忽略处理 
   3.  这 30 位分成 6 段, 每 5 位的数字作为字母表的索引取得特定字符, 依次进行获得 6 位字符串 
   4.  总的 `md5` 串可以获得 4 个 6 位串,取里面的任意一个就可作为这个长 url 的短 url 地址  

 算法1的好处就是简单好理解，永不重复。但是短码的长度不固定，随着 id 变大从一位长度开始递增。如果非要让短码长度固定也可以就是让 id 从指定的数字开始递增就可以了。百度短网址用的这种算法。开源短网址项目 [`YOURLS`](https://github.com/YOURLS/YOURLS/blob/master/includes/functions.php) 就是采用了这种算法。 

算法1和2是根据单机还是分布式来分的，优点同算法1，缺点就是不能保证长短链接1对1， 解决这个问题可以使用用key-value存储，保存“最近”生成的长对短的一个对应关系。注意是“最近”，也就是说，并不保存全量的长对短的关系，而只保存最近的。比如采用一小时过期的机制来实现LRU淘汰。 

 这样的话，长转短的流程变成这样：
　　1.0 在这个“最近”表中查看一下，看长地址有没有对应的短地址
　　1.1 有就直接返回，并且将这个key-value对的过期时间再延长成一小时
　　1.2 如果没有，就通过发号器生成一个短地址，并且将这个“最近”表中，过期时间为1小时
　　所以当一个地址被频繁使用，那么它会一直在这个key-value表中，总能返回当初生成那个短地址，不会出现重复的问题。如果它使用并不频繁，那么长对短的key会过期，LRU机制自动就会淘汰掉它。
　　当然，这不能保证100%的同一个长地址一定能转出同一个短地址，比如你拿一个生僻的url，每间隔1小时来转一次，你会得到不同的短地址。这样做对整个短系统是没有影响的。 

算法3，存在碰撞（重复）的可能性，虽然几率很小。短码位数是比较固定的。不会从一位长度递增到多位的。据说微博使用的这种算法。

